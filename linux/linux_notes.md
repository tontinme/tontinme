[SSD GC TRIM](#SSD-gc-trim)

# SSD gc trim

在SSD中，数据存储一般以page(页)为最小单位存储(典型的为4KB)，而128个page组成一个block(块)。数据以page为单位读取和写入，但只能以block为单位删除(删除时需要高压，page粒度太细，难以控制).



## gc

> 机械硬盘: 文件系统可以直接将数据写入到旧数据存储的位置，即可以直接覆盖旧数据。
> 固态硬盘: 如果想让存储无用数据的块写入新数据，就需要先把整个块删除，才可以写入新数据，也就是说固态硬盘不具备直接覆盖旧数据的能力。

对固态硬盘来说，GC(垃圾回收)是指把现存数据重新转移到其他闪存位置，并且把一些无用数据彻底删除的过程。GC写放大问题，当找不到可以写入的page写入新数据时，会执行GC过程，然后GC机制会将一些block中的有效数据合并写入到其他block中，再将这些block的无效数据擦除，再将新数据写入这些block。整个过程中，除了写入新数据，还写入了一些其他block合并过来的数据，这就是写入放大。

## trim或者discard

trim(或者discard)主要是为了提高SSD垃圾资源的回收效率以及减少写入放大的发生。trim将删除block的过程从覆盖写数据阶段提前到删除数据的时候。

trim和discard的支持，不仅需要SSD实现该功能，也需要整个数据链路涉及到的文件系统，RAID卡和SSD都需要实现。该功能必须在mount时，加上discard选项。可以通过hdparm -l命令检查是否支持。


